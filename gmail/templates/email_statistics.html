<head>
    <script type="text/javascript" src="/static/js/jquery-1.9.0.min.js"></script>
    <script src="/static/js/amcharts/amcharts.js" type="text/javascript"></script>
    <script src="/static/js/amcharts/serial.js" type="text/javascript"></script>
</head>

<body>
<script type="text/javascript">
</script>
    <div id="chartdiv" style="width:100%; height:400px;"></div>
<script>
AmCharts.ready(function(){
    var data_provider = [];
    var chart = AmCharts.makeChart("chartdiv", {
            "type": "serial",
            "theme": "none",
            "pathToImages": "/static/js/amcharts/images/",
            "dataDateFormat": "YYYY-MM-DD",
            "valueAxes": [{
                "axisAlpha": 0,
                "position": "left"
            }],
            "graphs": [{
                "id": "g1",
                "bullet": "round",
                "bulletBorderAlpha": 1,
                "bulletColor": "#FFFFFF",
                "bulletSize": 5,
                "hideBulletsCount": 50,
                "lineThickness": 2,
                "title": "red line",
                "useLineColorForBulletBorder": true,
                "valueField": "value"
            }],
            "chartScrollbar": {
                "graph": "g1",
                "scrollbarHeight": 30
            },
            "chartCursor": {
                "cursorPosition": "mouse",
                "pan": true
            },
            "categoryField": "date",
            "categoryAxis": {
                "parseDates": true,
                "dashLength": 1,
                "minorGridEnabled": true,
                "position": "bottom"
            },
            exportConfig:{
              menuRight: '20px',
              menuBottom: '50px',
              menuItems: [{
              icon: '/static/js/amcharts/images/export.png',
              format: 'png'   
              }]  
            },
            "dataProvider": data_provider
        }
    );


    $.getJSON('{% if current_folder %}{% url "email_statistics_json" current_folder %}{% else %}{% url "email_statistics_json" %}{% endif %}', function(data){
        var yAxis = {};
        $(data).each(function(idx, ele){
            var d = AmCharts.formatDate(new Date(parseInt(ele.date)), 'YYYY-MM-DD');
            yAxis[d] = (yAxis[d] || 0) + parseInt(ele.value);
        });
        $.each(yAxis, function(date, value){
            data_provider.push({
                'date': date,
                'value': value
            });
        });
        // Ensure ordered, otherwise it won't show, SHIT!!!
        data_provider.sort(function(a, b){return a.date > b.date;})
        chart.validateData();
    })

    chart.addListener("rendered", zoomChart);

    zoomChart();
    function zoomChart(){
        chart.zoomToIndexes(chart.dataProvider.length - 40, chart.dataProvider.length - 1);
    }
});
</script>
</body>
